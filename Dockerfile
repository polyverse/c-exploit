FROM php:7.1.8-apache

RUN apt-get update
RUN apt-get install -y vim nasm git gdb curl python netcat

WORKDIR /root
RUN git clone https://github.com/longld/peda.git
RUN echo "source /root/peda/peda.py" >> /root/.gdbinit
RUN echo 'peda.execute("set breakpoint pending on")' >> /root/peda/peda.py

WORKDIR /var/www/html
COPY index.php /var/www/html/
COPY main.c /var/www/html
COPY getenvaddr.c /var/www/html
COPY payload.py /var/www/html
COPY payload /var/www/html
COPY payload64 /var/www/html

RUN gcc -o getenvaddr getenvaddr.c
RUN gcc -g -fno-stack-protector -z execstack -o overflow main.c
