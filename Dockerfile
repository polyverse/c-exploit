FROM php:7.1.8-apache

RUN apt-get update
RUN apt-get install -y vim nasm git gdb curl python netcat net-tools socat telnet

WORKDIR /root
RUN git clone https://github.com/longld/peda.git
RUN echo "source /root/peda/peda.py" >> /root/.gdbinit
RUN echo 'peda.execute("set breakpoint pending on")' >> /root/peda/peda.py

WORKDIR /var/www/html
COPY index.php /var/www/html
COPY getenvaddr.c /var/www/html
COPY evil.c /var/www/html
COPY evil.php /var/www/html
COPY leak.c /var/www/html
COPY leak.php /var/www/html
COPY leak.py /var/www/html
COPY overflow.c /var/www/html
COPY payload.py /var/www/html
COPY payload /var/www/html
COPY payload64 /var/www/html

RUN gcc -std=c99 -o getenvaddr getenvaddr.c
RUN gcc -std=c99 -g -fno-stack-protector -z execstack -o evil evil.c
RUN gcc -fno-stack-protector -z execstack leak.c -o leak
RUN gcc -std=c99 -g -fno-stack-protector -z execstack -o overflow overflow.c
